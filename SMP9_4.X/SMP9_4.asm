		LIST P=PIC16F84A
		#INCLUDE<P16F84A.INC>
		
		__CONFIG _HS_OSC&_CP_OFF&_WDT_OFF&_PWRTE_ON

W_TEMP		EQU		0CH
STATUS_TEMP	EQU		0DH
CNT1		EQU		0EH
CNTB		EQU		0FH
TMPA		EQU		010H
OUT		EQU		011H

		ORG		0H
		GOTO	MAIN
			
		ORG		04H

;PUSH
		MOVWF	W_TEMP
		MOVF	STATUS,W
		MOVWF	STATUS_TEMP

		CALL	CRECV
		MOVWF	OUT

;POP
		MOVF	STATUS_TEMP,W
		MOVWF	STATUS
		SWAPF	W_TEMP,F
		SWAPF	W_TEMP,W
		BCF		INTCON,INTF
		RETFIE

;REMAINING CODE GOES HERE

MAIN
		BSF	STATUS,RP0
		BCF	INTCON,GIE
		CLRF	TRISA
		MOVLW	0FEH
		MOVWF	TRISB
		BCF	OPTION_REG,INTEDG
		BCF	STATUS,RP0
		BSF	INTCON,GIE
		BSF	INTCON,INTE

MAINLP
		MOVF	 OUT,W
		SUBLW   030H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L0
		
		MOVF	 OUT,W
		SUBLW   031H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L1
		
		MOVF	 OUT,W
		SUBLW   032H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L2
		
		MOVF	 OUT,W
		SUBLW   033H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L3
		
		MOVF	 OUT,W
		SUBLW   033H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L3
		
		MOVF	 OUT,W
		SUBLW   034H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L4
		
		MOVF	 OUT,W
		SUBLW   035H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L5
		
		MOVF	 OUT,W
		SUBLW   036H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L6
		
		MOVF	 OUT,W
		SUBLW   037H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L7
		
		MOVF	 OUT,W
		SUBLW   038H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L8
		
		MOVF	 OUT,W
		SUBLW   039H
		BTFSC   STATUS, Z   ; ??????????
		GOTO	 L9		
		
		GOTO	 MAINLP

L0
		MOVLW	00H
		MOVWF	PORTA
		GOTO	MAINLP
L1
		MOVLW	01H
		MOVWF	PORTA
		GOTO	MAINLP
		
L2
		MOVLW	02H
		MOVWF	PORTA
		GOTO	MAINLP

L3
		MOVLW	03H
		MOVWF	PORTA
		GOTO	MAINLP
		
L4
		MOVLW	04H
		MOVWF	PORTA
		GOTO	MAINLP

L5
		MOVLW	01H
		MOVWF	PORTB
		GOTO	MAINLP
		
L6
		MOVLW	02H
		MOVWF	PORTB
		GOTO	MAINLP
		
L7
		MOVLW	03H
		MOVWF	PORTB
		GOTO	MAINLP
		
L8
		MOVLW	04H
		MOVWF	PORTB
		GOTO	MAINLP
		
L9
		MOVLW	05H
		MOVWF	PORTB
		GOTO	MAINLP
		
CRECV
		CLRF	TMPA
		MOVLW	08H
		MOVWF	CNTB
		CALL	TIME156

CRECVLP
		BTFSC	PORTB,0
		BSF	STATUS,C
		BTFSS	PORTB,0
		BCF	STATUS,C
		RRF	TMPA,F
		CALL	TIME104
		DECFSZ	CNTB,F
		GOTO	CRECVLP
		MOVF	TMPA,W
		RETURN

TIME156
		MOVLW	0C3H
		MOVWF	CNT1
LOOP1
		NOP
		DECFSZ	CNT1,F
		GOTO	LOOP1
		RETURN

TIME104
		MOVLW	082H
		MOVWF	CNT1
LOOP2
		NOP
		DECFSZ	CNT1,F
		GOTO	LOOP2
		RETURN

		END